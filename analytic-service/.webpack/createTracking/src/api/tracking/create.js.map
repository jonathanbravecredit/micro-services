{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"source-map-support/register\"","webpack:///external \"@shiftcoders/dynamo-easy\"","webpack:///external \"ajv\"","webpack:///external \"reflect-metadata\"","webpack:////Users/jonathanpizzolato/Projects/brave-credit/dev/services/marketing-services/analytic-service/lib/models/analytics.model.ts","webpack:////Users/jonathanpizzolato/Projects/brave-credit/dev/services/marketing-services/analytic-service/lib/queries/analytics/analytics.queries.ts","webpack:////Users/jonathanpizzolato/Projects/brave-credit/dev/services/marketing-services/analytic-service/lib/queries/index.ts","webpack:////Users/jonathanpizzolato/Projects/brave-credit/dev/services/marketing-services/analytic-service/lib/schema/validation.ts","webpack:////Users/jonathanpizzolato/Projects/brave-credit/dev/services/marketing-services/analytic-service/lib/utils/response.ts","webpack:////Users/jonathanpizzolato/Projects/brave-credit/dev/services/marketing-services/analytic-service/lib/utils/safeJson.ts","webpack:////Users/jonathanpizzolato/Projects/brave-credit/dev/services/marketing-services/analytic-service/src/api/tracking/create.ts"],"names":[],"mappings":"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","file":"src/api/tracking/create.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 5);\n","module.exports = require(\"source-map-support/register\");","module.exports = require(\"@shiftcoders/dynamo-easy\");","module.exports = require(\"ajv\");","module.exports = require(\"reflect-metadata\");","import { Model, PartitionKey, SortKey } from '@shiftcoders/dynamo-easy';\n\n@Model({ tableName: 'Analytics' })\nexport class Analytics {\n  @PartitionKey()\n  id!: string;\n  @SortKey()\n  event!: string;\n  sub!: string | null;\n  session!: string;\n  source!: string;\n  value?: number;\n  createdOn?: string;\n  modifiedOn?: string;\n}\n\nexport class AnalyticsMaker implements Analytics {\n  id: string;\n  event: string;\n  sub: string | null;\n  session: string;\n  source: string;\n  value: number;\n  createdOn: string | undefined;\n  modifiedOn: string | undefined;\n\n  constructor(id: string, event: string, sub: string | null, session: string, source: string, value: number = 1) {\n    this.id = id;\n    this.event = event;\n    this.sub = sub;\n    this.session = session;\n    this.source = source;\n    this.value = value;\n    this.createdOn = new Date().toISOString();\n    this.modifiedOn = new Date().toISOString();\n  }\n}\n","import { DynamoStore } from '@shiftcoders/dynamo-easy';\nimport { Analytics } from 'lib/models/analytics.model';\n\nconst store = new DynamoStore(Analytics);\n\nexport const getAnalytics = (analyticId: string): Promise<Analytics | null> => {\n  return store\n    .get(analyticId)\n    .exec()\n    .then((res) => res)\n    .catch((err) => err);\n};\n\nexport const listAnalyticss = (): Promise<Analytics[]> => {\n  return store\n    .scan()\n    .execFetchAll()\n    .then((res) => res)\n    .catch((err) => err);\n};\n\nexport const createAnalytics = (Analytics: Analytics): Promise<void> => {\n  return store\n    .put(Analytics)\n    .ifNotExists()\n    .exec()\n    .then((res) => res)\n    .catch((err) => err);\n};\n\nexport const deleteAnalytics = (analyticId: string): Promise<void> => {\n  return store\n    .delete(analyticId)\n    .returnValues('ALL_OLD')\n    .exec()\n    .then((res) => res)\n    .catch((err) => err);\n};\n","import 'reflect-metadata';\nexport * from './analytics/analytics.queries';\n","import Ajv from 'ajv';\nexport const ajv = new Ajv();\nimport * as analyticCreate from './analytic_create.json';\najv.addSchema(analyticCreate, 'analyticCreate');\n","/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/explicit-module-boundary-types */\nimport { APIGatewayProxyResult } from 'aws-lambda';\n\nexport const response = (statusCode: number, body: any): APIGatewayProxyResult => ({\n  statusCode,\n  headers: {\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Credentials': true,\n    'Access-Control-Allow-Headers': 'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token',\n  },\n  body: JSON.stringify(body, null, 2),\n});\n\nexport const success = (body: any): APIGatewayProxyResult => response(200, body);\nexport const failure = (body: any): APIGatewayProxyResult => response(500, body);\n","/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/explicit-module-boundary-types */\nexport const hasJsonStructure = (str: string): boolean => {\n  if (typeof str !== 'string') return false;\n  try {\n    const result = JSON.parse(str);\n    const type = Object.prototype.toString.call(result);\n    return type === '[object Object]' || type === '[object Array]';\n  } catch (err) {\n    return false;\n  }\n};\n\nexport const safeParse = (data: any, eventKey: string): any => {\n  if (Object.prototype.hasOwnProperty.call(data, eventKey)) {\n    if (hasJsonStructure(data[eventKey])) {\n      return JSON.parse(data[eventKey]);\n    }\n    return data[eventKey];\n  }\n  if (hasJsonStructure(data)) {\n    return JSON.parse(data);\n  }\n  return data;\n};\n","'use strict';\nimport * as interfaces from 'lib/interfaces';\nimport * as queries from 'lib/queries';\nimport { ajv } from 'lib/schema/validation';\nimport { response } from 'lib/utils/response';\nimport { APIGatewayProxyHandler, APIGatewayProxyEvent, APIGatewayProxyResult } from 'aws-lambda';\nimport { safeParse } from 'lib/utils/safeJson';\nimport { Analytics, AnalyticsMaker } from 'lib/models/analytics.model';\n\nexport const main: APIGatewayProxyHandler = async (\n  proxyEvent: APIGatewayProxyEvent,\n): Promise<APIGatewayProxyResult> => {\n  const payload: interfaces.ICreateAnalytic = safeParse(proxyEvent, 'body');\n  const validate = ajv.getSchema<interfaces.ICreateAnalytic>('analyticCreate');\n  if (!validate || !validate(payload)) throw `Malformed message=${JSON.stringify(payload)}`;\n  try {\n    const { id, event, sub, session, source, value } = payload;\n    const analytic: Analytics = new AnalyticsMaker(id, event, sub, session, source, value);\n    await queries.createAnalytics(analytic);\n    return response(200, 'success');\n  } catch (error) {\n    return response(500, error);\n  }\n};\n"],"sourceRoot":""}